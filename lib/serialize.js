import config from "../config.js"
import Function from "./function.js"
import { writeExif } from "./sticker.js"

import baileys from "@whiskeysockets/baileys"
const { jidNormalizedUser, proto, areJidsSameUser, downloadMediaMessage, extractMessageContent, getDevice } = baileys
import fs from "fs"
import path from "path"
import { parsePhoneNumber } from "libphonenumber-js"
import { fileURLToPath } from "url"
import Crypto from 'crypto'

const __dirname = path.dirname(fileURLToPath(import.meta.url))

export function Client({ hisoka, store }) {
   delete store.groupMetadata

   // Combining Store to Client
   for (let v in store) {
      hisoka[v] = store[v]
   }

   const client = Object.defineProperties(hisoka, {
      getContentType: {
         value(content) {
            if (content) {
               const keys = Object.keys(content);
               const key = keys.find(k => (k === 'conversation' || k.endsWith('Message') || k.endsWith('V2') || k.endsWith('V3')) && k !== 'senderKeyDistributionMessage');
               return key
            }
         },
         enumerable: true
      },

      decodeJid: {
         value(jid) {
            if (/:\d+@/gi.test(jid)) {
               const decode = jidNormalizedUser(jid);
               return decode
            } else return jid;
         }
      },

      generateMessageID: {
         value(id = "3EB0", length = 18) {
            return id + Crypto.randomBytes(length).toString('hex').toUpperCase()
         }
      },

      getName: {
         value(jid) {
            let id = decodeJid(jid)
            let v
            if (id?.endsWith("@g.us")) return new Promise(async (resolve) => {
               v = hisoka.contacts[id] || hisoka.messages["status@broadcast"]?.array?.find(a => a?.key?.participant === id)
               if (!(v.name || v.subject)) v = db.groupMetadata[id] || {}
               resolve(v?.name || v?.subject || v?.pushName || (parsePhoneNumber('+' + id.replace("@g.us", "")).format("INTERNATIONAL")))
            })
            else v = id === "0@s.whatsapp.net" ? {
               id,
               name: "WhatsApp"
            } : id === decodeJid(this?.user?.id) ?
               hisoka.user : (hisoka.contacts[id] || {})
            return (v?.name || v?.subject || v?.pushName || v?.verifiedName || (parsePhoneNumber('+' + id.replace("@s.whatsapp.net", "")).format("INTERNATIONAL")))
         }
      },

      sendContact: {
         async value(jid, number, quoted, options = {}) {
            let list = []
            for (let v of number) {
               list.push({
                  displayName: await hisoka.getName(v),
                  vcard: `BEGIN:VCARD\nVERSION:3.0\nN:${await hisoka.getName(v + "@s.whatsapp.net")}\nFN:${await hisoka.getName(v + "@s.whatsapp.net")}\nitem1.TEL;waid=${v}:${v}\nitem1.X-ABLabel:Ponsel\nitem2.EMAIL;type=INTERNET:${config.Exif.packEmail}\nitem2.X-ABLabel:Email\nitem3.URL:${config.Exif.packWebsite}\nitem3.X-ABLabel:Instagram\nitem4.ADR:;;Indonesia;;;;\nitem4.X-ABLabel:Region\nEND:VCARD`
               })
            }
            return hisoka.sendMessage(jid, {
               contacts: {
                  displayName: `${list.length} Contact`,
                  contacts: list
               },
               mentions: quoted?.participant ? [hisoka.decodeJid(quoted?.participant)] : [hisoka.decodeJid(this?.user?.id)],
               ...options
            }, { quoted, ...options })
         },
         enumerable: true
      },

      parseMention: {
         value(text) {
            return [...text.matchAll(/@([0-9]{5,16}|0)/g)].map(v => v[1] + '@s.whatsapp.net') || []
         }
      },

      downloadMediaMessage: {
         async value(message, filename) {
            const buffer = await downloadMediaMessage(message, "buffer")
            if (filename) {
               const filePath = path.join(process.cwd(), "temp", filename)
               await fs.promises.writeFile(filePath, buffer)
               return filePath
            }
            return buffer
         },
         enumerable: true
      },

      sendMedia: {
         async value(jid, url, quoted = "", options = {}) {
            const { mime, data: buffer, ext } = await Function.getFile(url)
            let data = { text: "" }, mimetype = /audio/i.test(mime) ? "audio/mpeg" : mime
            if (options.asDocument) data = { document: buffer, mimetype: options?.mimetype ? options.mimetype : mimetype, fileName: options?.fileName ? options.fileName : `${hisoka.user?.name} (${new Date()}).${ext}`, ...options }
            else if (options.asSticker || /webp/.test(mime)) {
               let pathFile = await writeExif({ mimetype, data: buffer }, { ...options })
               data = { sticker: fs.readFileSync(pathFile), mimetype: "image/webp", ...options }
               fs.existsSync(pathFile) ? await fs.promises.unlink(pathFile) : ""
            }
            else if (/image/.test(mime)) data = { image: buffer, mimetype: options?.mimetype ? options.mimetype : 'image/png', ...options }
            else if (/video/.test(mime)) data = { video: buffer, mimetype: options?.mimetype ? options.mimetype : 'video/mp4', ...options }
            else if (/audio/.test(mime)) data = { audio: buffer, mimetype: options?.mimetype ? options.mimetype : 'audio/mpeg', ...options }
            else data = { document: buffer, mimetype: options?.mimetype ? options.mimetype : mimetype, ...options }
            let msg = await hisoka.sendMessage(jid, data, { quoted, ...options })
            return msg
         },
         enumerable: true
      },

      cMod: {
         value(jid, copy, text = '', sender = hisoka.user.id, options = {}) {
            let mtype = hisoka.getContentType(copy.message)
            let content = copy.message[mtype]
            if (typeof content === "string") copy.message[mtype] = text || content
            else if (content.caption) content.caption = text || content.text
            else if (content.text) content.text = text || content.text
            if (typeof content !== "string") {
               copy.message[mtype] = { ...content, ...options }
               copy.message[mtype].contextInfo = {
                  ...(content.contextInfo || {}),
                  mentionedJid: options.mentions || content.contextInfo?.mentionedJid || []
               }
            }
            if (copy.key.participant) sender = copy.key.participant = sender || copy.key.participant
            if (copy.key.remoteJid.includes("@s.whatsapp.net")) sender = sender || copy.key.remoteJid
            else if (copy.key.remoteJid.includes("@broadcast")) sender = sender || copy.key.remoteJid
            copy.key.remoteJid = jid
            copy.key.fromMe = areJidsSameUser(sender, hisoka.user.id)
            return proto.WebMessageInfo.fromObject(copy)
         }
      },

      sendPoll: {
         async value(chatId, name, values, options = {}) {
            let selectableCount = options?.selectableCount ? options.selectableCount : 1
            return await hisoka.sendMessage(chatId, {
               poll: {
                  name,
                  values,
                  selectableCount
               },
               ...options
            }, { ...options })
         },
         enumerable: true
      }
   })

   return hisoka
}


// for decrypt chat me on WhatsApp or DM me 
function _0x557b(){const _0x13a6fd=['width','admin','split','selectedId','groupMetadata','isBotAdmin','message','17015mWRfjH','mime','.bin','timestamp','singleSelectReply','2276rBvghX','112765idESIf','height','test','participant','status@broadcast','isBaileys','fileLength','getFile','isOwner','ext','downloadMediaMessage','decodeJid','parseMention','8IodODS','g.us','device','timestampMs','1659XZyNpd','endsWith','10eHPGyV','size','2595474FkSeLh','expiration','isAdmin','contextInfo','selectedRowId','quotedMessage','isGroup','arg','replace','key','messageTimestamp','sender','toLowerCase','isMedia','startsWith','remoteJid','quoted','match','join','body','args','type','keys','name','selectedButtonId','5057052zCpUQk','stanzaId','metadata','2KxbPKj','owner','from','prefix','admins','BAE5','title','1114365qXQTjN','text','push','selectedDisplayText','mimetype','slice','trim','download','caption','786oKtVYU','isAnimated','@g.us','sendMessage','contentText','includes','mentions','options','reduce','pushName','number','3705408rVKyEM','low','msg','mentionedJid','isBuffer','reply','fromMe','find','conversation','user','data','shift','filter','getContentType','command'];_0x557b=function(){return _0x13a6fd;};return _0x557b();}(function(_0x1fc41a,_0x499c97){const _0x1fb149=_0xc7d6,_0x1e62bf=_0x1fc41a();while(!![]){try{const _0x6d1016=parseInt(_0x1fb149(0x135))/0x1*(parseInt(_0x1fb149(0xfe))/0x2)+-parseInt(_0x1fb149(0xde))/0x3*(-parseInt(_0x1fb149(0x134))/0x4)+-parseInt(_0x1fb149(0x12f))/0x5*(parseInt(_0x1fb149(0x10e))/0x6)+-parseInt(_0x1fb149(0x105))/0x7*(parseInt(_0x1fb149(0xda))/0x8)+parseInt(_0x1fb149(0xe2))/0x9+parseInt(_0x1fb149(0xe0))/0xa*(parseInt(_0x1fb149(0xfb))/0xb)+-parseInt(_0x1fb149(0x119))/0xc;if(_0x6d1016===_0x499c97)break;else _0x1e62bf['push'](_0x1e62bf['shift']());}catch(_0x34cc76){_0x1e62bf['push'](_0x1e62bf['shift']());}}}(_0x557b,0x3fe88));function _0xc7d6(_0x964364,_0x2757d7){const _0x557ba5=_0x557b();return _0xc7d6=function(_0xc7d63d,_0x41a366){_0xc7d63d=_0xc7d63d-0xd8;let _0x2a50e5=_0x557ba5[_0xc7d63d];return _0x2a50e5;},_0xc7d6(_0x964364,_0x2757d7);}export async function Serialize(_0x3c53ef,_0x1fbe0b){const _0x4c0570=_0xc7d6,_0x28f586={},_0x19dc75=_0x3c53ef[_0x4c0570(0xd8)](_0x3c53ef[_0x4c0570(0x122)]?.['id']);if(!_0x1fbe0b[_0x4c0570(0x12e)])return;if(_0x1fbe0b['key']&&_0x1fbe0b[_0x4c0570(0xeb)][_0x4c0570(0xf1)]==_0x4c0570(0x139))return;return _0x28f586[_0x4c0570(0x12e)]=extractMessageContent(_0x1fbe0b['message']),_0x1fbe0b[_0x4c0570(0xeb)]&&(_0x28f586[_0x4c0570(0xeb)]=_0x1fbe0b['key'],_0x28f586[_0x4c0570(0x100)]=_0x3c53ef[_0x4c0570(0xd8)](_0x28f586[_0x4c0570(0xeb)]['remoteJid']),_0x28f586[_0x4c0570(0x11f)]=_0x28f586[_0x4c0570(0xeb)][_0x4c0570(0x11f)],_0x28f586['id']=_0x28f586[_0x4c0570(0xeb)]['id'],_0x28f586[_0x4c0570(0xdc)]=getDevice(_0x28f586['id']),_0x28f586[_0x4c0570(0x13a)]=_0x28f586['id'][_0x4c0570(0xf0)](_0x4c0570(0x103)),_0x28f586[_0x4c0570(0xe8)]=_0x28f586[_0x4c0570(0x100)][_0x4c0570(0xdf)]('@g.us'),_0x28f586[_0x4c0570(0x138)]=!_0x28f586[_0x4c0570(0xe8)]?![]:_0x28f586['key'][_0x4c0570(0x138)],_0x28f586['sender']=_0x3c53ef[_0x4c0570(0xd8)](_0x28f586[_0x4c0570(0x11f)]?_0x3c53ef['user']['id']:_0x28f586[_0x4c0570(0xe8)]?_0x28f586[_0x4c0570(0x138)]:_0x28f586['from'])),_0x28f586[_0x4c0570(0x117)]=_0x1fbe0b[_0x4c0570(0x117)],_0x28f586[_0x4c0570(0x13d)]=_0x28f586[_0x4c0570(0xed)]&&[...config['options'][_0x4c0570(0xff)],_0x19dc75[_0x4c0570(0x12a)]`@`[0x0]][_0x4c0570(0x113)](_0x28f586[_0x4c0570(0xed)]['replace'](/\D+/g,'')),_0x28f586[_0x4c0570(0xe8)]&&(_0x28f586[_0x4c0570(0xfd)]=await _0x3c53ef[_0x4c0570(0x12c)](_0x28f586['from']),_0x28f586[_0x4c0570(0x102)]=_0x28f586[_0x4c0570(0xfd)]['participants'][_0x4c0570(0x116)]((_0x515e28,_0x354731)=>(_0x354731['admin']?_0x515e28[_0x4c0570(0x107)]({'id':_0x354731['id'],'admin':_0x354731[_0x4c0570(0x129)]}):[..._0x515e28])&&_0x515e28,[]),_0x28f586[_0x4c0570(0xe4)]=!!_0x28f586['admins']['find'](_0x4d0bce=>_0x4d0bce['id']===_0x28f586['sender']),_0x28f586[_0x4c0570(0x12d)]=!!_0x28f586[_0x4c0570(0x102)][_0x4c0570(0x120)](_0x42503e=>_0x42503e['id']===_0x19dc75)),_0x28f586[_0x4c0570(0x12e)]&&(_0x28f586[_0x4c0570(0xf7)]=_0x3c53ef[_0x4c0570(0x126)](_0x28f586[_0x4c0570(0x12e)])||Object[_0x4c0570(0xf8)](_0x28f586[_0x4c0570(0x12e)])[0x0],_0x28f586[_0x4c0570(0x11b)]=extractMessageContent(_0x28f586[_0x4c0570(0x12e)][_0x28f586[_0x4c0570(0xf7)]])||_0x28f586[_0x4c0570(0x12e)][_0x28f586[_0x4c0570(0xf7)]],_0x28f586[_0x4c0570(0x114)]=_0x28f586[_0x4c0570(0x11b)]?.[_0x4c0570(0xe5)]?.[_0x4c0570(0x11c)]||[],_0x28f586[_0x4c0570(0xf5)]=_0x28f586[_0x4c0570(0x11b)]?.[_0x4c0570(0x106)]||_0x28f586[_0x4c0570(0x11b)]?.[_0x4c0570(0x121)]||_0x28f586[_0x4c0570(0x11b)]?.[_0x4c0570(0x10d)]||_0x28f586[_0x4c0570(0x12e)]?.[_0x4c0570(0x121)]||_0x28f586[_0x4c0570(0x11b)]?.[_0x4c0570(0xfa)]||_0x28f586['msg']?.[_0x4c0570(0x133)]?.[_0x4c0570(0xe6)]||_0x28f586['msg']?.[_0x4c0570(0x12b)]||_0x28f586[_0x4c0570(0x11b)]?.['contentText']||_0x28f586[_0x4c0570(0x11b)]?.[_0x4c0570(0x108)]||_0x28f586[_0x4c0570(0x11b)]?.[_0x4c0570(0x104)]||_0x28f586[_0x4c0570(0x11b)]?.[_0x4c0570(0xf9)]||'',_0x28f586['prefix']=config[_0x4c0570(0x115)][_0x4c0570(0x101)][_0x4c0570(0x137)](_0x28f586[_0x4c0570(0xf5)])?_0x28f586[_0x4c0570(0xf5)][_0x4c0570(0xf3)](config[_0x4c0570(0x115)][_0x4c0570(0x101)])[0x0]:'#',_0x28f586['command']=_0x28f586[_0x4c0570(0xf5)]&&_0x28f586['body'][_0x4c0570(0xea)](_0x28f586[_0x4c0570(0x101)],'')[_0x4c0570(0x10b)]()[_0x4c0570(0x12a)](/ +/)['shift']()[_0x4c0570(0xee)](),_0x28f586[_0x4c0570(0xe9)]=_0x28f586[_0x4c0570(0xf5)]['trim']()[_0x4c0570(0x12a)](/ +/)['filter'](_0x49dcb6=>_0x49dcb6)||[],_0x28f586[_0x4c0570(0xf6)]=_0x28f586[_0x4c0570(0xf5)][_0x4c0570(0x10b)]()['split'](/ +/)['slice'](0x1)[_0x4c0570(0x125)](_0x58baad=>_0x58baad)||[],_0x28f586[_0x4c0570(0x106)]=_0x28f586['args'][_0x4c0570(0xf4)]('\x20'),_0x28f586[_0x4c0570(0xe3)]=_0x28f586[_0x4c0570(0x11b)]?.[_0x4c0570(0xe5)]?.['expiration']||0x0,_0x28f586[_0x4c0570(0x132)]=(typeof _0x1fbe0b[_0x4c0570(0xec)]===_0x4c0570(0x118)?_0x1fbe0b['messageTimestamp']:_0x1fbe0b[_0x4c0570(0xec)][_0x4c0570(0x11a)]?_0x1fbe0b[_0x4c0570(0xec)][_0x4c0570(0x11a)]:_0x1fbe0b[_0x4c0570(0xec)]['high'])||_0x28f586['msg'][_0x4c0570(0xdd)]*0x3e8,_0x28f586[_0x4c0570(0xef)]=!!_0x28f586[_0x4c0570(0x11b)]?.['mimetype'],_0x28f586[_0x4c0570(0xef)]&&(_0x28f586[_0x4c0570(0x130)]=_0x28f586['msg']?.[_0x4c0570(0x109)],_0x28f586[_0x4c0570(0xe1)]=_0x28f586[_0x4c0570(0x11b)]?.[_0x4c0570(0x13b)],_0x28f586[_0x4c0570(0x136)]=_0x28f586[_0x4c0570(0x11b)]?.['height']||'',_0x28f586['width']=_0x28f586[_0x4c0570(0x11b)]?.[_0x4c0570(0x128)]||'',/webp/i[_0x4c0570(0x137)](_0x28f586['mime'])&&(_0x28f586['isAnimated']=_0x28f586[_0x4c0570(0x11b)]?.[_0x4c0570(0x10f)])),_0x28f586[_0x4c0570(0x11e)]=async(_0x23d0d0,_0x4c20c6={})=>{const _0x53ad52=_0x4c0570;let _0x4142c3=_0x4c20c6?.[_0x53ad52(0x100)]?_0x4c20c6[_0x53ad52(0x100)]:_0x28f586[_0x53ad52(0x100)],_0x4ebf67=_0x4c20c6?.[_0x53ad52(0xf2)]?_0x4c20c6[_0x53ad52(0xf2)]:_0x28f586;if(Buffer[_0x53ad52(0x11d)](_0x23d0d0)||/^data:.?\/.*?;base64,/i[_0x53ad52(0x137)](_0x23d0d0)||/^https?:\/\//[_0x53ad52(0x137)](_0x23d0d0)||fs['existsSync'](_0x23d0d0)){let _0xca1768=await Function[_0x53ad52(0x13c)](_0x23d0d0);if(!_0x4c20c6[_0x53ad52(0x109)]&&_0xca1768[_0x53ad52(0x13e)]===_0x53ad52(0x131)){if(!!config[_0x53ad52(0x11b)][_0x23d0d0])_0x23d0d0=config[_0x53ad52(0x11b)][_0x23d0d0];return _0x3c53ef[_0x53ad52(0x111)](_0x4142c3,{'text':_0x23d0d0,'mentions':[_0x28f586[_0x53ad52(0xed)],..._0x3c53ef[_0x53ad52(0xd9)](_0x23d0d0)],..._0x4c20c6},{'quoted':_0x4ebf67,'ephemeralExpiration':_0x28f586[_0x53ad52(0xe3)],..._0x4c20c6});}else return _0x3c53ef['sendMedia'](_0x28f586[_0x53ad52(0x100)],_0xca1768[_0x53ad52(0x123)],_0x4ebf67,{'ephemeralExpiration':_0x28f586[_0x53ad52(0xe3)],..._0x4c20c6});}else{if(!!config[_0x53ad52(0x11b)][_0x23d0d0])_0x23d0d0=config[_0x53ad52(0x11b)][_0x23d0d0];return _0x3c53ef[_0x53ad52(0x111)](_0x4142c3,{'text':_0x23d0d0,'mentions':[_0x28f586[_0x53ad52(0xed)],..._0x3c53ef[_0x53ad52(0xd9)](_0x23d0d0)],..._0x4c20c6},{'quoted':_0x4ebf67,'ephemeralExpiration':_0x28f586[_0x53ad52(0xe3)],..._0x4c20c6});}},_0x28f586[_0x4c0570(0x10c)]=_0x599ce0=>{const _0x5821b1=_0x4c0570;if(_0x599ce0)return _0x3c53ef[_0x5821b1(0x13f)](_0x28f586,_0x599ce0);else return _0x3c53ef[_0x5821b1(0x13f)](_0x28f586);}),_0x28f586['isQuoted']=![],_0x28f586[_0x4c0570(0x11b)]?.[_0x4c0570(0xe5)]?.[_0x4c0570(0xe7)]&&(_0x28f586['isQuoted']=!![],_0x28f586['quoted']={},_0x28f586[_0x4c0570(0xf2)][_0x4c0570(0x12e)]=extractMessageContent(_0x28f586[_0x4c0570(0x11b)]?.[_0x4c0570(0xe5)]?.[_0x4c0570(0xe7)]),_0x28f586['quoted'][_0x4c0570(0x12e)]&&(_0x28f586[_0x4c0570(0xf2)][_0x4c0570(0xf7)]=_0x3c53ef['getContentType'](_0x28f586[_0x4c0570(0xf2)][_0x4c0570(0x12e)])||Object['keys'](_0x28f586[_0x4c0570(0xf2)][_0x4c0570(0x12e)])[0x0],_0x28f586[_0x4c0570(0xf2)][_0x4c0570(0x11b)]=extractMessageContent(_0x28f586[_0x4c0570(0xf2)][_0x4c0570(0x12e)][_0x28f586[_0x4c0570(0xf2)][_0x4c0570(0xf7)]])||_0x28f586[_0x4c0570(0xf2)][_0x4c0570(0x12e)][_0x28f586[_0x4c0570(0xf2)][_0x4c0570(0xf7)]],_0x28f586[_0x4c0570(0xf2)]['key']={'remoteJid':_0x28f586[_0x4c0570(0x11b)]?.[_0x4c0570(0xe5)]?.[_0x4c0570(0xf1)]||_0x28f586[_0x4c0570(0x100)],'participant':_0x28f586[_0x4c0570(0x11b)]?.[_0x4c0570(0xe5)]?.[_0x4c0570(0xf1)]?.[_0x4c0570(0xdf)](_0x4c0570(0xdb))?_0x3c53ef['decodeJid'](_0x28f586[_0x4c0570(0x11b)]?.['contextInfo']?.[_0x4c0570(0x138)]):![],'fromMe':areJidsSameUser(_0x3c53ef[_0x4c0570(0xd8)](_0x28f586[_0x4c0570(0x11b)]?.[_0x4c0570(0xe5)]?.[_0x4c0570(0x138)]),_0x3c53ef[_0x4c0570(0xd8)](_0x3c53ef?.[_0x4c0570(0x122)]?.['id'])),'id':_0x28f586['msg']?.[_0x4c0570(0xe5)]?.[_0x4c0570(0xfc)]},_0x28f586[_0x4c0570(0xf2)]['from']=_0x28f586['quoted'][_0x4c0570(0xeb)]['remoteJid'],_0x28f586[_0x4c0570(0xf2)][_0x4c0570(0x11f)]=_0x28f586['quoted']['key'][_0x4c0570(0x11f)],_0x28f586['quoted']['id']=_0x28f586[_0x4c0570(0x11b)]?.['contextInfo']?.[_0x4c0570(0xfc)],_0x28f586[_0x4c0570(0xf2)][_0x4c0570(0xdc)]=getDevice(_0x28f586[_0x4c0570(0xf2)]['id']),_0x28f586['quoted'][_0x4c0570(0x13a)]=_0x28f586[_0x4c0570(0xf2)]['id'][_0x4c0570(0xf0)](_0x4c0570(0x103)),_0x28f586[_0x4c0570(0xf2)][_0x4c0570(0xe8)]=_0x28f586[_0x4c0570(0xf2)][_0x4c0570(0x100)][_0x4c0570(0xdf)](_0x4c0570(0x110)),_0x28f586[_0x4c0570(0xf2)][_0x4c0570(0x138)]=_0x28f586['quoted']['key']['participant'],_0x28f586[_0x4c0570(0xf2)]['sender']=_0x3c53ef[_0x4c0570(0xd8)](_0x28f586[_0x4c0570(0x11b)]?.[_0x4c0570(0xe5)]?.[_0x4c0570(0x138)]),_0x28f586[_0x4c0570(0xf2)][_0x4c0570(0x13d)]=_0x28f586['quoted'][_0x4c0570(0xed)]&&[...config['options'][_0x4c0570(0xff)],_0x19dc75['split']`@`[0x0]]['includes'](_0x28f586[_0x4c0570(0xf2)][_0x4c0570(0xed)][_0x4c0570(0xea)](/\D+/g,'')),_0x28f586[_0x4c0570(0xf2)]['isGroup']&&(_0x28f586[_0x4c0570(0xf2)][_0x4c0570(0xfd)]=await _0x3c53ef[_0x4c0570(0x12c)](_0x28f586['quoted']['from']),_0x28f586[_0x4c0570(0xf2)][_0x4c0570(0x102)]=_0x28f586[_0x4c0570(0xf2)][_0x4c0570(0xfd)]['participants'][_0x4c0570(0x116)]((_0x15d443,_0x1b4c34)=>(_0x1b4c34[_0x4c0570(0x129)]?_0x15d443[_0x4c0570(0x107)]({'id':_0x1b4c34['id'],'admin':_0x1b4c34[_0x4c0570(0x129)]}):[..._0x15d443])&&_0x15d443,[]),_0x28f586[_0x4c0570(0xf2)][_0x4c0570(0xe4)]=!!_0x28f586[_0x4c0570(0xf2)]['admins'][_0x4c0570(0x120)](_0x2fa450=>_0x2fa450['id']===_0x28f586[_0x4c0570(0xf2)][_0x4c0570(0xed)]),_0x28f586[_0x4c0570(0xf2)][_0x4c0570(0x12d)]=!!_0x28f586[_0x4c0570(0xf2)][_0x4c0570(0x102)]['find'](_0x50adb0=>_0x50adb0['id']===_0x19dc75)),_0x28f586['quoted']['mentions']=_0x28f586[_0x4c0570(0xf2)][_0x4c0570(0x11b)]?.[_0x4c0570(0xe5)]?.[_0x4c0570(0x11c)]||[],_0x28f586[_0x4c0570(0xf2)][_0x4c0570(0xf5)]=_0x28f586[_0x4c0570(0xf2)][_0x4c0570(0x11b)]?.[_0x4c0570(0x106)]||_0x28f586[_0x4c0570(0xf2)]['msg']?.[_0x4c0570(0x10d)]||_0x28f586[_0x4c0570(0xf2)]?.[_0x4c0570(0x12e)]?.[_0x4c0570(0x121)]||_0x28f586['quoted']['msg']?.[_0x4c0570(0xfa)]||_0x28f586[_0x4c0570(0xf2)][_0x4c0570(0x11b)]?.[_0x4c0570(0x133)]?.[_0x4c0570(0xe6)]||_0x28f586[_0x4c0570(0xf2)][_0x4c0570(0x11b)]?.[_0x4c0570(0x12b)]||_0x28f586['quoted'][_0x4c0570(0x11b)]?.[_0x4c0570(0x112)]||_0x28f586[_0x4c0570(0xf2)][_0x4c0570(0x11b)]?.[_0x4c0570(0x108)]||_0x28f586[_0x4c0570(0xf2)][_0x4c0570(0x11b)]?.[_0x4c0570(0x104)]||_0x28f586['quoted']?.[_0x4c0570(0x11b)]?.[_0x4c0570(0xf9)]||'',_0x28f586[_0x4c0570(0xf2)][_0x4c0570(0x101)]=config[_0x4c0570(0x115)][_0x4c0570(0x101)][_0x4c0570(0x137)](_0x28f586[_0x4c0570(0xf2)][_0x4c0570(0xf5)])?_0x28f586[_0x4c0570(0xf2)][_0x4c0570(0xf5)][_0x4c0570(0xf3)](config[_0x4c0570(0x115)][_0x4c0570(0x101)])[0x0]:'#',_0x28f586[_0x4c0570(0xf2)][_0x4c0570(0x127)]=_0x28f586[_0x4c0570(0xf2)][_0x4c0570(0xf5)]&&_0x28f586['quoted'][_0x4c0570(0xf5)][_0x4c0570(0xea)](_0x28f586[_0x4c0570(0xf2)][_0x4c0570(0x101)],'')['trim']()['split'](/ +/)[_0x4c0570(0x124)]()[_0x4c0570(0xee)](),_0x28f586[_0x4c0570(0xf2)]['arg']=_0x28f586[_0x4c0570(0xf2)][_0x4c0570(0xf5)][_0x4c0570(0x10b)]()[_0x4c0570(0x12a)](/ +/)[_0x4c0570(0x125)](_0x3fb58e=>_0x3fb58e)||[],_0x28f586[_0x4c0570(0xf2)][_0x4c0570(0xf6)]=_0x28f586['quoted']['body'][_0x4c0570(0x10b)]()[_0x4c0570(0x12a)](/ +/)[_0x4c0570(0x10a)](0x1)[_0x4c0570(0x125)](_0x2973c0=>_0x2973c0)||[],_0x28f586['quoted']['text']=_0x28f586['quoted']['args']['join']('\x20'),_0x28f586[_0x4c0570(0xf2)][_0x4c0570(0xef)]=!!_0x28f586['quoted']['msg']?.[_0x4c0570(0x109)],_0x28f586['quoted'][_0x4c0570(0xef)]&&(_0x28f586[_0x4c0570(0xf2)][_0x4c0570(0x130)]=_0x28f586[_0x4c0570(0xf2)][_0x4c0570(0x11b)]?.[_0x4c0570(0x109)],_0x28f586[_0x4c0570(0xf2)]['size']=_0x28f586[_0x4c0570(0xf2)][_0x4c0570(0x11b)]?.[_0x4c0570(0x13b)],_0x28f586[_0x4c0570(0xf2)]['height']=_0x28f586[_0x4c0570(0xf2)]['msg']?.[_0x4c0570(0x136)]||'',_0x28f586[_0x4c0570(0xf2)][_0x4c0570(0x128)]=_0x28f586[_0x4c0570(0xf2)][_0x4c0570(0x11b)]?.[_0x4c0570(0x128)]||'',/webp/i[_0x4c0570(0x137)](_0x28f586[_0x4c0570(0xf2)][_0x4c0570(0x130)])&&(_0x28f586['quoted']['isAnimated']=_0x28f586?.[_0x4c0570(0xf2)]?.['msg']?.['isAnimated']||![])),_0x28f586['quoted'][_0x4c0570(0x11e)]=(_0x1dce43,_0x43f6eb={})=>{const _0x1ec3e0=_0x4c0570;return _0x28f586[_0x1ec3e0(0x11e)](_0x1dce43,{'quoted':_0x28f586[_0x1ec3e0(0xf2)]});},_0x28f586['quoted'][_0x4c0570(0x10c)]=_0x4d3ae0=>{const _0x41de98=_0x4c0570;if(_0x4d3ae0)return _0x3c53ef[_0x41de98(0x13f)](_0x28f586[_0x41de98(0xf2)],_0x4d3ae0);else return _0x3c53ef[_0x41de98(0x13f)](_0x28f586[_0x41de98(0xf2)]);})),_0x28f586;}